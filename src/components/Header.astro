---
import HeaderLink from "./HeaderLink.astro";
import ThemeButton from "./ThemeButton.astro";
import { SITE_TITLE } from "../consts";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import LanguagePicker from "./LanguagePicker.astro";
import SearchBar from "./SearchBar.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import { DEFAULT_LANG } from "../i18n/conf";

const lang = getLangFromUrl(Astro.url);
const homeUrl = lang !== DEFAULT_LANG ? `/${lang}/` : `/`;
const t = useTranslations(lang);
---

<header>
  <a class="header__logo" href={homeUrl}>
    <img height="66" width="54" src="/icons/logo.png" alt="Dylan toon photo" />
    <h2>
      {SITE_TITLE}
    </h2>
  </a>
  <nav id="header__nav" class="header__nav">
    <div class="header__internal-links">
      <HeaderLink href={getRelativeLocaleUrl(lang, "/")}>
        {t("nav.blog")}
      </HeaderLink>
      <HeaderLink href={getRelativeLocaleUrl(lang, "/about/")}>
        {t("nav.about")}
      </HeaderLink>
    </div>
    <div class="header__tools">
      <ThemeButton />
      <SearchBar />
      <LanguagePicker />
    </div>
  </nav>
  <img id="header__menu-icon" class="header__menu-icon" src="/icons/menu.svg" />
</header>
<script>
  function handleMobileMenu() {
    const ACTIVE_CLASS = "header__menu-icon-active";
    const NAV_OPEN_CLASS = "header__nav--open";

    const menu = document.getElementById("header__menu-icon");
    const nav = document.getElementById("header__nav");

    if (!(menu && nav)) {
      return;
    }

    menu.addEventListener("click", () => {
      if (menu.classList.contains(ACTIVE_CLASS)) {
        menu.classList.remove(ACTIVE_CLASS);
        nav.classList.remove(NAV_OPEN_CLASS);
        return;
      }

      menu.classList.add(ACTIVE_CLASS);
      nav.classList.add(NAV_OPEN_CLASS);
    });
  }

  handleMobileMenu();

  document.addEventListener("astro:after-swap", () => {
    handleMobileMenu();
  });
</script>
<style>
  header {
    height: 72px;
    margin: 0;
    padding: 0 16px;
    background: var(--header-background);
    border-bottom: var(--layout-border);
    box-shadow: 0 2px 8px rgba(black, 5%);
    display: flex;
    flex-direction: row;
    align-items: center;
    width: 100%;
    gap: 16px;

    a,
    a.active {
      text-decoration: none;
    }
  }

  .header__internal-links {
    flex: 1;
    display: flex;
    justify-content: center;

    a {
      padding: 0 0.5em;
    }
  }

  .header__tools {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .header__menu-icon {
    display: none;
    height: 80%;
    padding: 4px;
    margin-left: auto;
    cursor: pointer;

    &.header__menu-icon-active {
      border-bottom: 4px solid transparent;
      border-bottom-color: var(--accent);
    }
  }

  .header__logo {
    display: flex;
    flex-direction: row;
    gap: 8px;
    align-items: center;

    h2 {
      margin: 0;
      font-size: 20px;
      color: var(--color);

      a,
      a.active {
        text-decoration: none;
      }
    }
  }

  .header__nav {
    display: flex;
    align-items: center;
    gap: 16px;
    flex: 1;

    a {
      color: var(--color);
      border-bottom: 4px solid transparent;
      text-decoration: none;

      &.active {
        text-decoration: none;
        border-bottom-color: var(--accent);
      }
    }
  }

  @media (max-width: 900px) {
    .header__menu-icon {
      display: block;
    }

    .header__nav {
      display: none;
      position: absolute;
      z-index: 100;
      flex-direction: column-reverse;
      gap: 16px;
      padding: 16px;
      width: 100%;
      background: var(--background-color);
      top: 72px;
      left: 0;
      right: 0;
      box-shadow: 0 2px 8px rgba(var(black), 5%);

      &.header__nav--open {
        display: flex;
      }

      .header__internal-links {
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        font-size: 24px;
        gap: 16px;
      }

      .header__tools {
        justify-content: center;
        flex-wrap: wrap-reverse;
      }
    }
  }
</style>
